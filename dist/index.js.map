{"version":3,"file":"index.js","sources":["../getImage.ts","../getBsImage.ts","../getDeviceImage.ts","../getIcon.ts"],"sourcesContent":["export function getImage(src): Promise<HTMLImageElement> {\n  const image: HTMLImageElement = new Image();\n  return new Promise(resolve => {\n    image.onload = () => resolve(image);\n    image.src = src;\n  });\n}\n","import { getImage } from \"./getImage\";\nconst canvas = document.createElement(\"canvas\");\ncanvas.width = 60;\ncanvas.height = 20;\nconst context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\ncontext.imageSmoothingEnabled = true;\n\nconst cache = {};\nexport async function getBsImage(bs) {\n  if (cache[bs]) {\n    return cache[bs];\n  }\n  context.fillStyle = \"white\";\n  context.fillRect(0, 0, canvas.width, canvas.height);\n  context.textAlign = \"center\";\n  context.textBaseline = \"top\";\n  context.fillStyle = \"black\";\n  context.font = \"bold 18px Arial\";\n  context.fillText(bs, canvas.width / 2, 0, canvas.width);\n  const data = canvas.toDataURL();\n  const result = await getImage(data);\n  cache[bs] = result;\n  return result;\n}\n","import { getImage } from \"./getImage\";\n\n// const IMAGES = {\n//   OFF: require(\"@/assets/car/off.png\"),\n//   RUNNING: require(\"@/assets/car/running.png\"),\n//   STOP: require(\"@/assets/car/stop.png\"),\n//   LOST_POWER: require(\"@/assets/car/lost.gif\"),\n//   NO_GPS: require(\"@/assets/car/no_gps.gif\")\n// };\n\n// const IMG_SIZE = 40;\n// const ICON_W = 35;\n// const ICON_H = 30;\n\nconst canvas = document.createElement(\"canvas\");\nconst context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\ncontext.imageSmoothingEnabled = true;\n\nfunction getDataImage(status, IMAGES): Promise<HTMLImageElement> {\n  const src = IMAGES[status];\n  if (!src) {\n    console.error(\"no image status\", status);\n  }\n  return getImage(src);\n}\nconst cache = {};\n\nexport async function getDeviceImage(\n  status,\n  angle,\n  { IMAGES, ICON_SIZE, IMG_W, IMG_H }\n) {\n  angle = Math.round(angle);\n  if (cache[status + angle]) {\n    return cache[status + angle];\n  }\n  const carImage = await getDataImage(status, IMAGES);\n\n  canvas.width = ICON_SIZE;\n  canvas.height = ICON_SIZE;\n  context.clearRect(0, 0, canvas.width, canvas.height);\n  context.save();\n  context.translate(canvas.width / 2, canvas.height / 2);\n  context.rotate((angle * Math.PI) / 180);\n  context.drawImage(\n    carImage,\n    0,\n    0,\n    carImage.naturalWidth,\n    carImage.naturalHeight,\n    -IMG_W / 2,\n    -IMG_H / 2,\n    IMG_W,\n    IMG_H\n  );\n  context.restore();\n  const data = canvas.toDataURL();\n  const result = await getImage(data);\n  cache[status + angle] = result;\n  return result;\n}\n","import { getBsImage } from \"./getBsImage\";\nimport { getDeviceImage } from \"./getDeviceImage\";\n\nconst ICON_SIZE = 52; // === DEVICE_W\nconst DEVICE_W = ICON_SIZE;\nconst TEXT_PER = 0.4;\nconst TEXT_H = Math.round(TEXT_PER * ICON_SIZE);\nconst DEVICE_H = ICON_SIZE + TEXT_H;\n\nconst ANCHOR = ICON_SIZE / 2;\n\nconst canvas = document.createElement(\"canvas\");\ncanvas.width = DEVICE_W;\ncanvas.height = DEVICE_H;\nconst context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\ncontext.imageSmoothingEnabled = true;\nconst cache = {};\nexport async function getIcon(status, angle, bs, ICON_CONFIG) {\n  angle = angle % 360;\n  if (cache[status + angle + bs]) {\n    return cache[status + angle + bs];\n  }\n  let deviceImage;\n  deviceImage = await getDeviceImage(status, angle, ICON_CONFIG);\n  context.clearRect(0, 0, canvas.width, canvas.height);\n  context.drawImage(\n    deviceImage,\n    0,\n    0,\n    deviceImage.naturalWidth,\n    deviceImage.naturalHeight,\n    0,\n    0,\n    ICON_SIZE,\n    ICON_SIZE\n  );\n  const bsImage = await getBsImage(bs);\n  context.drawImage(\n    bsImage,\n    0,\n    0,\n    bsImage.naturalWidth,\n    bsImage.naturalHeight,\n    0,\n    DEVICE_H - TEXT_H,\n    canvas.width,\n    TEXT_H\n  );\n  const result = {\n    url: canvas.toDataURL(),\n    // size: { width: 30, height: 60 },\n    origin: { x: 0, y: 0 },\n    anchor: { x: ANCHOR, y: ANCHOR },\n    scaledSize: { width: DEVICE_W, height: DEVICE_H }\n  };\n  cache[status + angle + bs] = result;\n  return result;\n}\n"],"names":["getImage","src","image","Image","Promise","resolve","onload","canvas","document","createElement","width","height","context","getContext","imageSmoothingEnabled","cache","getDeviceImage","status","angle","IMAGES","ICON_SIZE","IMG_W","IMG_H","Math","round","console","error","getDataImage","then","carImage","$await_1","clearRect","save","translate","rotate","PI","drawImage","naturalWidth","naturalHeight","restore","data","toDataURL","result","$await_2","DEVICE_W","TEXT_H","DEVICE_H","ANCHOR","bs","ICON_CONFIG","deviceImage","fillStyle","fillRect","textAlign","textBaseline","font","fillText","getBsImage","bsImage","url","origin","x","y","anchor","scaledSize"],"mappings":"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"}