{"version":3,"file":"index.umd.js","sources":["../getImage.ts","../getBsImage.ts","../getDeviceImage.ts","../getIcon.ts"],"sourcesContent":["export function getImage(src): Promise<HTMLImageElement> {\n  const image: HTMLImageElement = new Image();\n  return new Promise(resolve => {\n    image.onload = () => resolve(image);\n    image.src = src;\n  });\n}\n","import { getImage } from \"./getImage\";\nconst canvas = document.createElement(\"canvas\");\ncanvas.width = 60;\ncanvas.height = 20;\nconst context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\ncontext.imageSmoothingEnabled = true;\n\nconst cache = {};\nexport async function getBsImage(bs) {\n  if (cache[bs]) {\n    return cache[bs];\n  }\n  context.fillStyle = \"white\";\n  context.fillRect(0, 0, canvas.width, canvas.height);\n  context.textAlign = \"center\";\n  context.textBaseline = \"top\";\n  context.fillStyle = \"black\";\n  context.font = \"bold 18px Arial\";\n  context.fillText(bs, canvas.width / 2, 0, canvas.width);\n  const data = canvas.toDataURL();\n  const result = await getImage(data);\n  cache[bs] = result;\n  return result;\n}\n","import { getImage } from './getImage'\n\n// const IMAGES = {\n//   OFF: require(\"@/assets/car/off.png\"),\n//   RUNNING: require(\"@/assets/car/running.png\"),\n//   STOP: require(\"@/assets/car/stop.png\"),\n//   LOST_POWER: require(\"@/assets/car/lost.gif\"),\n//   NO_GPS: require(\"@/assets/car/no_gps.gif\")\n// };\n\n// const IMG_SIZE = 40;\n// const ICON_W = 35;\n// const ICON_H = 30;\n\nconst canvas = document.createElement('canvas')\nconst context = canvas.getContext('2d') as CanvasRenderingContext2D\ncontext.imageSmoothingEnabled = true\n\nfunction getDataImage(status, IMAGES): Promise<HTMLImageElement> {\n  const src = IMAGES[status]\n  if (!src) {\n    console.error('no image status', status)\n  }\n  return getImage(src)\n}\nconst cache = {}\n\nexport async function getDeviceImage(\n  status,\n  angle,\n  { IMAGES, ICON_SIZE, IMG_W, IMG_H },\n) {\n  angle = Math.round(angle)\n  const cacheKey = status + '|' + angle\n  if (cache[cacheKey]) {\n    return cache[cacheKey]\n  }\n  const carImage = await getDataImage(status, IMAGES)\n\n  canvas.width = ICON_SIZE\n  canvas.height = ICON_SIZE\n  context.clearRect(0, 0, canvas.width, canvas.height)\n  context.save()\n  context.translate(canvas.width / 2, canvas.height / 2)\n  context.rotate((angle * Math.PI) / 180)\n  context.drawImage(\n    carImage,\n    0,\n    0,\n    carImage.naturalWidth,\n    carImage.naturalHeight,\n    -IMG_W / 2,\n    -IMG_H / 2,\n    IMG_W,\n    IMG_H,\n  )\n  context.restore()\n  const data = canvas.toDataURL()\n  const result = await getImage(data)\n  cache[cacheKey] = result\n  return result\n}\n","import { getBsImage } from './getBsImage'\nimport { getDeviceImage } from './getDeviceImage'\n\nconst ICON_SIZE = 52 // === DEVICE_W\nconst DEVICE_W = ICON_SIZE\nconst TEXT_PER = 0.4\nconst TEXT_H = Math.round(TEXT_PER * ICON_SIZE)\nconst DEVICE_H = ICON_SIZE + TEXT_H\n\nconst ANCHOR = ICON_SIZE / 2\n\nconst canvas = document.createElement('canvas')\ncanvas.width = DEVICE_W\ncanvas.height = DEVICE_H\nconst context = canvas.getContext('2d') as CanvasRenderingContext2D\ncontext.imageSmoothingEnabled = true\nconst cache = {}\nexport async function getIcon(status, angle, bs, ICON_CONFIG) {\n  angle = angle % 360\n  const cacheKey = `${status}.${angle}.${bs}`\n  if (cache[cacheKey]) {\n    return cache[cacheKey]\n  }\n  let deviceImage\n  deviceImage = await getDeviceImage(status, angle, ICON_CONFIG)\n  context.clearRect(0, 0, canvas.width, canvas.height)\n  context.drawImage(\n    deviceImage,\n    0,\n    0,\n    deviceImage.naturalWidth,\n    deviceImage.naturalHeight,\n    0,\n    0,\n    ICON_SIZE,\n    ICON_SIZE,\n  )\n  const bsImage = await getBsImage(bs)\n  context.drawImage(\n    bsImage,\n    0,\n    0,\n    bsImage.naturalWidth,\n    bsImage.naturalHeight,\n    0,\n    DEVICE_H - TEXT_H,\n    canvas.width,\n    TEXT_H,\n  )\n  const result = {\n    url: canvas.toDataURL(),\n    // size: { width: 30, height: 60 },\n    origin: { x: 0, y: 0 },\n    anchor: { x: ANCHOR, y: ANCHOR },\n    scaledSize: { width: DEVICE_W, height: DEVICE_H },\n  }\n  cache[cacheKey] = result\n  return result\n}\n"],"names":["getImage","src","image","Image","Promise","resolve","onload","canvas","document","createElement","width","height","context","getContext","imageSmoothingEnabled","cache","getDeviceImage","status","angle","IMAGES","ICON_SIZE","IMG_W","IMG_H","Math","round","cacheKey","console","error","getDataImage","then","carImage","$await_1","clearRect","save","translate","rotate","PI","drawImage","naturalWidth","naturalHeight","restore","data","toDataURL","result","$await_2","DEVICE_W","TEXT_H","DEVICE_H","ANCHOR","bs","ICON_CONFIG","deviceImage","fillStyle","fillRect","textAlign","textBaseline","font","fillText","getBsImage","bsImage","url","origin","x","y","anchor","scaledSize"],"mappings":"kLAAgBA,EAASC,GACvB,MAAMC,EAA0B,IAAIC,MACpC,OAAO,IAAIC,QAAQC,IACjBH,EAAMI,YAAeD,EAAQH,IAC7BA,EAAMD,IAAMA,ICHhB,MAAMM,EAASC,SAASC,cAAc,UACtCF,EAAOG,MAAQ,GACfH,EAAOI,OAAS,GAChB,MAAMC,EAAUL,EAAOM,WAAW,MAClCD,EAAQE,uBAAwB,EAEhC,MAAMC,EAAQ,GCOd,MAAMR,EAASC,SAASC,cAAc,UAChCG,EAAUL,EAAOM,WAAW,QAC1BC,uBAAwB,EAShC,MAAMC,EAAQ,GAEP,SAAeC,EACpBC,EACAC,GACAC,OAAEA,YAAQC,QAAWC,QAAOC,IAHvB,6CAOL,OAFAJ,EAAQK,KAAKC,MAAMN,GAEfH,EADEU,EAAWR,EAAS,IAAMC,KAEvBH,EAAMU,IAjBjB,SAAsBR,EAAQE,GAC5B,MAAMlB,EAAMkB,EAAOF,GAInB,OAHKhB,GACHyB,QAAQC,MAAM,kBAAmBV,GAE5BjB,EAASC,GAcO2B,CAAaX,EAAQE,GAA3BU,qBAqBF,OArBTC,EAAWC,EAEjBxB,EAAOG,MAAQU,EACfb,EAAOI,OAASS,EAChBR,EAAQoB,UAAU,EAAG,EAAGzB,EAAOG,MAAOH,EAAOI,QAC7CC,EAAQqB,OACRrB,EAAQsB,UAAU3B,EAAOG,MAAQ,EAAGH,EAAOI,OAAS,GACpDC,EAAQuB,OAAQjB,EAAQK,KAAKa,GAAM,KACnCxB,EAAQyB,UACNP,EACA,EACA,EACAA,EAASQ,aACTR,EAASS,eACRlB,EAAQ,GACRC,EAAQ,EACTD,EACAC,GAEFV,EAAQ4B,UAEaxC,EADfyC,EAAOlC,EAAOmC,aACLb,qBAEf,OADAd,EAAMU,GADAkB,EAASC,IAERD,yDCzDT,MAAMvB,EAAY,GACZyB,EAAWzB,EAEX0B,EAASvB,KAAKC,MADH,GACoBJ,GAC/B2B,EAAW3B,EAAY0B,EAEvBE,EAAS5B,EAAY,EAErBb,EAASC,SAASC,cAAc,YAC/BC,MAAQmC,IACRlC,OAASoC,EAChB,MAAMnC,EAAUL,EAAOM,WAAW,QAC1BC,uBAAwB,EAChC,MAAMC,EAAQ,UACP,SAAuBE,EAAQC,EAAO+B,EAAIC,GAA1C,6CAGL,OAAInC,EADEU,KAAcR,KADpBC,GAAgB,OACuB+B,OAE9BlC,EAAMU,IAGKT,EAAeC,EAAQC,EAAOgC,GAApCrB,qBAaE,OAbhBsB,EAAcpB,EACdnB,EAAQoB,UAAU,EAAG,EAAGzB,EAAOG,MAAOH,EAAOI,QAC7CC,EAAQyB,UACNc,EACA,EACA,EACAA,EAAYb,aACZa,EAAYZ,cACZ,EACA,EACAnB,EACAA,GF3BG,SAA0B6B,GAA1B,yCACL,OAAIlC,EAAMkC,KACDlC,EAAMkC,KAEfrC,EAAQwC,UAAY,QACpBxC,EAAQyC,SAAS,EAAG,EAAG9C,EAAOG,MAAOH,EAAOI,QAC5CC,EAAQ0C,UAAY,SACpB1C,EAAQ2C,aAAe,MACvB3C,EAAQwC,UAAY,QACpBxC,EAAQ4C,KAAO,kBACf5C,EAAQ6C,SAASR,EAAI1C,EAAOG,MAAQ,EAAG,EAAGH,EAAOG,OAE5BV,EADfyC,EAAOlC,EAAOmC,aACLb,qBAEf,OADAd,EAAMkC,GADAN,EAASZ,IAERY,gCEeee,CAAWT,GAAjBpB,qBAoBhB,OAnBAjB,EAAQyB,UADFsB,EAAUf,EAGd,EACA,EACAe,EAAQrB,aACRqB,EAAQpB,cACR,EACAQ,EAAWD,EACXvC,EAAOG,MACPoC,GAEIH,EAAS,CACbiB,IAAKrD,EAAOmC,YAEZmB,OAAQ,CAAEC,EAAG,EAAGC,EAAG,GACnBC,OAAQ,CAAEF,EAAGd,EAAQe,EAAGf,GACxBiB,WAAY,CAAEvD,MAAOmC,EAAUlC,OAAQoC,IAEzChC,EAAMU,GAAYkB,IACXA"}